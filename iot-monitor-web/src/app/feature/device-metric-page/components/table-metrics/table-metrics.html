<div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 max-w-6xl mx-auto">
  <div
    class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 space-y-2 sm:space-y-0"
  >
    <h2 class="text-lg sm:text-xl font-semibold text-gray-800">Histórico de Métricas</h2>
    <span class="text-xs sm:text-sm text-gray-500">
      Últimas mediciones del dispositivo {{ deviceResource.value()?.name }}
    </span>
  </div>
  <!--Exportar a excel-->
  <div class="flex flex-col sm:flex-row sm:justify-between gap-3 mb-3 items-center">
    <!-- Botón Volver -->
    <button
      mat-raised-button
      class="flex items-center justify-center gap-2 w-full sm:w-auto"
      (click)="goToMetric(deviceResource.value()!)"
    >
      <mat-icon>arrow_back</mat-icon>
      <span class="hidden sm:inline">Volver</span>
    </button>

    <!-- Formulario Date Range -->
    <form [formGroup]="formRangePicker" class="w-full sm:w-auto flex items-center gap-2">
      <mat-form-field class="w-full sm:w-72">
        <mat-date-range-input [rangePicker]="picker">
          <input matStartDate placeholder="fecha inicial" formControlName="start" />
          <input matEndDate placeholder="fecha final" formControlName="end" />
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>
    </form>

    <!-- Botón Exportar -->
    <button
      mat-raised-button
      color="primary"
      class="flex items-center justify-center gap-2 w-full sm:w-auto"
      (click)="exportExcel()"
    >
      <mat-icon>file_download</mat-icon>
      <span class="hidden sm:inline">Exportar a Excel</span>
    </button>
  </div>

  <div class="overflow-x-auto rounded-lg border border-gray-200">
    <table mat-table [dataSource]="dataSource" class="w-full min-w-[500px] sm:min-w-full">
      <!-- Columna Dispositivo -->
      <ng-container matColumnDef="metric">
        <th
          mat-header-cell
          *matHeaderCellDef
          class="px-4 py-2 text-center text-gray-600 text-sm sm:text-base"
        >
          Métricas
        </th>
        <td mat-cell *matCellDef="let row" class="px-4 py-2 text-sm">
          {{ row.metric }}
        </td>
      </ng-container>
      <ng-container matColumnDef="percent">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2 text-center text-gray-600 text-sm">
          Porcentaje
        </th>
        <td mat-cell *matCellDef="let row" class="px-4 py-2 text-sm text-center">
          {{ row.valueNum | number : '1.2-2' }}%
        </td>
      </ng-container>
      <ng-container matColumnDef="recordedAt">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2 text-center text-gray-600 text-sm">
          Fecha y hora
        </th>
        <td mat-cell *matCellDef="let row" class="px-4 py-2 text-sm text-center">
          {{ row.recordedAt | date : 'dd/MM/yyyy HH:mm' }}
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        class="hover:!bg-blue-500 hover:!text-white transition cursor-pointer"
        *matRowDef="let row; columns: displayedColumns"
      ></tr>
    </table>
    <div class="mt-4 flex justify-center sm:justify-end">
      <mat-paginator
        [length]="dataSource.data.length || 0"
        [pageSizeOptions]="[5, 10, 15, 20]"
        showFirstLastButtons
        aria-label="Select Metric"
      ></mat-paginator>
    </div>
  </div>
</div>
